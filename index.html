<!DOCTYPE HTML>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>abcjs basic demo</title>
	<link href="css/abcjs-audio.css" media="all" rel="stylesheet" type="text/css" />
	<script src="js/abcjs-basic-min.js" type="text/javascript"></script>
	<style>
		.abcjs-inline-audio {
			max-width: 770px;
		}
		.abcjs-highlight {
		fill: #0a9ecc;
		}
		</style>
</head>
<body>

<div id="notationBb"></div>
<div id="audio"></div>
<div style="visibility:hidden; border: 1px solid rgb(150, 140, 140)" id="notationC"></div>
<form action="index.html" method="get">
	Song: <select name="song">
		<option value="air">Air - Bach</option>
		<option value="auldLangSyne">Auld Lang Syne - Robert Burnes</option>
		<option value="lipSlur">Lip Slur Exercise</option>
		<option value="gymnopedie1">Gymnopedie 1 - Erik Satie</option>
	</select><br />
	Bmp: <input name="tempo" value="60" />
	<input type="submit" value="Show"/>
</form>

<script type="text/javascript">
	const queryString = window.location.search;
	const urlParams = new URLSearchParams(queryString);
	const song = urlParams.get('song')
	const tempo = urlParams.get('tempo')

	function onMidi() {
		if (ABCJS.synth.supportsAudio()) {
			var visualObjBb = ABCJS.renderAbc('notationBb', fileContentBb, {responsive: 'resize'})[0];
			var visualObjC = ABCJS.renderAbc('notationC', fileContentC, {responsive: 'resize'})[0];
			var synthControl = new ABCJS.synth.SynthController();
			synthControl.load("#audio", null, {displayRestart: true, displayPlay: true, displayProgress: true});
			synthControl.setTune(visualObjC, false);
		} else {
			document.querySelector("#audio").innerHTML = "<div class='audio-error'>Audio is not supported in this browser.</div>";
		}
	}

    function readTextFile(file)
    {
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
		var texten = "";
        rawFile.onreadystatechange = function ()
        {
            if(rawFile.readyState === 4)
            {
                if(rawFile.status === 200 || rawFile.status == 0)
                {
                    texten = rawFile.responseText;
                }
            }
        }
		rawFile.send(null);
		return texten;
    }
	var fileContentBb = readTextFile("abc/"+ song + ".abc")
	var fileContentC = readTextFile("abc/"+ song + "BT.abc")
	if(tempo != null) {fileContentBb = fileContentBb.replace(/Q:.*?\n/i,"Q:1/4="+tempo+"\n")}
	if(tempo != null) {fileContentC = fileContentC.replace(/Q:.*?\n/i,"Q:1/4="+tempo+"\n")}
    onMidi();
    // ABCJS.renderAbc("notation", fileContent);
</script>

</body>
</html>